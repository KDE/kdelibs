<HTML>
<HEAD>
<TITLE>The aRts C API</TITLE>
</HEAD>
<BODY bgcolor="#EAEEEE">
<H3>The aRts C API</h3>
<p>
The aRts plain C API aims at easily writing/porting plain C apps to the
aRts sound server. What is provided is streaming functionality (sending
sample streams to artsd), either blocking or non-blocking. So for most
apps, you simply remove the few system calls that deal with your audio
device, and replace them with the appropriate aRts calls.
</p>
<p>
I did two ports as proof of concept, that is <b>mpg123</b> and <b>quake</b>.
You can get the patches
<a href="http://space.twc.de/~stefan/kde/download/artsc-patches.tar.gz">here</a>.
Of course feel free to submit your own patches either to me and/or to
maintainers of software packages so that they can integrate aRts support
in their code.
</p>
<H4>Quick walkthrough</H4>
<p>
Sending audio to the sound server with that API is very simple.
<ol>
<li>use a #include &lt;artsc.h&gt;
<li>initialize the API with <a href="#arts_init">arts_init()</a>
<li>create a stream with <a href="#arts_play_stream">arts_play_stream()</a>
<li>eventually configure specific parameters with <a href="#arts_stream_set">arts_stream_set()</a>
<li>write sampling data to the stream with <a href="#arts_write">arts_write()</a>
<li>close the stream with <a href="#arts_close_stream">arts_close_stream()</a>
<li>free the API with <a href="#arts_free">arts_free()</a>
</ol>
</p>
<p>
And here is a small example that illustrates this:
<pre>
int main()
{
	arts_stream_t stream;
	char buffer[8192];
	int bytes;
	int errorcode;

	errorcode = arts_init();
	if(errorcode &lt; 0)
	{
		fprintf(stderr,"arts_init error: %s\n", arts_error_text(errorcode));
		return 1;
	}

	stream = arts_play_stream(44100,16,2,"artsctest");

	while((bytes = fread(buffer,1,8192,stdin)) &gt; 0)
	{
		errorcode = arts_write(stream,buffer,bytes);
		if(errorcode &lt; 0)
		{
			fprintf(stderr,"arts_write error: %s\n",arts_error_text(errorcode));
			return 1;
		}
	}

	arts_close_stream(stream);
	arts_free();

	return 0;
}
</pre>
<p>
<H4>Compiling & Linking: artsc-config</H4>
<p>
To easily compile and link programs using the aRts C API, there is the
artsc-config tool which knows which libraries you need to link and where
the includes are.
</p>
<p>
It is called like 
<pre>
$ artsc-config --libs
</pre>
to find out the libraries, and like
<pre>
$ artsc-config --cflags
</pre>
to find out additional cflags. This means, that the example above could
be compiled like
<pre>
$ cc -o artsctest artsctest.c `artsc-config --cflags` `artsc-config --libs`
</pre>
</p>
<p>
<H4>Library Reference</H4>
<p>
<A NAME="arts_init"></A><A NAME="ref4"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>int &nbsp;<underline>arts_init</underline> ()
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 initializes the aRts C API, and connects to the sound server
</p><p></p><p><b>Returns</b>: 0 if everything is all right, an error code otherwise
 </p>
<A NAME="arts_free"></A><A NAME="ref5"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>void &nbsp;<underline>arts_free</underline> ()
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 disconnects from the sound server and frees the aRts C API internals
 </p><A NAME="arts_error_text"></A><A NAME="ref6"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>const char *&nbsp;<underline>arts_error_text</underline> (int errorcode)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 converts an error code to a human readable error message
</p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>errorcode</i></TD><TD align="left" valign="top">the errorcode (from another arts function that failed)
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: a text string with the error message
 </p>
<A NAME="arts_play_stream"></A><A NAME="ref7"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>arts_stream_t &nbsp;<underline>arts_play_stream</underline> (int rate, int bits, int channels, char *name)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 open a stream for playing
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>rate</i></TD><TD align="left" valign="top">the sampling rate (something like 44100)
</TD></TR>
<TR><TD align="left" valign="top"><i>bits</i></TD><TD align="left" valign="top">how many bits each sample has (8 or 16)
</TD></TR>
<TR><TD align="left" valign="top"><i>channels</i></TD><TD align="left" valign="top">how many channels, 1 is mono, 2 is stereo
</TD></TR>
<TR><TD align="left" valign="top"><i>name</i></TD><TD align="left" valign="top">the name of the stream (these will be used so that the user can
          assign streams to effects/mixer channels and similar)
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: a stream
 </p>
<A NAME="arts_record_stream"></A><A NAME="ref8"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>arts_stream_t &nbsp;<underline>arts_record_stream</underline> (int rate, int bits, int channels, char *name)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 open a stream for recording
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>rate</i></TD><TD align="left" valign="top">the sampling rate (something like 44100)
</TD></TR>
<TR><TD align="left" valign="top"><i>bits</i></TD><TD align="left" valign="top">how many bits each sample has (8 or 16)
</TD></TR>
<TR><TD align="left" valign="top"><i>channels</i></TD><TD align="left" valign="top">how many channels, 1 is mono, 2 is stereo
</TD></TR>
<TR><TD align="left" valign="top"><i>name</i></TD><TD align="left" valign="top">the name of the stream (these will be used so that the user can
          assign streams to effects/mixer channels and similar)
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: a stream
 </p>
<A NAME="arts_close_stream"></A><A NAME="ref9"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>void &nbsp;<underline>arts_close_stream</underline> (arts_stream_t stream)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 close a stream
 </p><A NAME="arts_read"></A><A NAME="ref10"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>int &nbsp;<underline>arts_read</underline> (arts_stream_t stream, void *buffer, int count)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 read samples from stream
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>stream</i></TD><TD align="left" valign="top">a previously opened record stream
</TD></TR>
<TR><TD align="left" valign="top"><i>buffer</i></TD><TD align="left" valign="top">a buffer with sample data
</TD></TR>
<TR><TD align="left" valign="top"><i>count</i></TD><TD align="left" valign="top">the number of bytes contained in the buffer
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: number of read bytes on success or error code
 </p>
<A NAME="arts_write"></A><A NAME="ref11"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>int &nbsp;<underline>arts_write</underline> (arts_stream_t stream, void *buffer, int count)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 write samples to to stream
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>stream</i></TD><TD align="left" valign="top">a previously opened play stream
</TD></TR>
<TR><TD align="left" valign="top"><i>buffer</i></TD><TD align="left" valign="top">a buffer with sample data
</TD></TR>
<TR><TD align="left" valign="top"><i>count</i></TD><TD align="left" valign="top">the number of bytes contained in the buffer
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: number of written bytes on success or error code
 </p>
<A NAME="arts_parameter_t"></A><A NAME="ref3"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>typedef enum {...} <underline>arts_parameter_t</underline></strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 parameters for streams
</p><p></p><ul>
<li>ARTS_P_BUFFER_SIZE (rw)
   The size of the internal buffers used for streaming to the server - this
   directly affects the latency that will occur. If you never set it
   explicitely, this value defaults to at least 65536 (64kb). Generally,
   it is important to know that the server itself gives some constraints
   which makes buffer sizes below a certain value impossible. So setting
   this parameter will always result in either getting what you wanted,
   or a larger streaming buffer due to server limitations.
</li>
</ul><p>
</p><p></p><ul>
<li>ARTS_P_BUFFER_TIME (rw)
   The time the buffer used for streaming to the server takes to play in
   milliseconds. This is just a more human readable method to set the buffer
   size, so setting ARTS_P_BUFFER_SIZE affects this parameter and the other
   way round. As aRts chooses reasonable buffer sizes for streaming (rather
   3*16kb than 40234 bytes), setting this parameter will often end up with
   a slightly larger value than you requested.
</li>
</ul><p>
</p><p></p><ul>
<li>ARTS_P_BUFFER_SPACE (r)
   The amount of bytes that can be read/written without blocking (depending
   whether this is a record or play stream). As requesting this parameter
   does a few system calls (but no remote invocation) to verify that it is
   up-to-date, don't overuse it.
</li>
</ul><p>
</p><p></p><ul>
<li>ARTS_P_SERVER_LATENCY (r)
   The amount of latency the server creates (due to hardware buffering)
   in milliseconds.
</li>
</ul><p>
</p><p></p><ul>
<li>ARTS_P_TOTAL_LATENCY (r)
   The overall latency in milliseconds it takes (at most), from the time
   when you write a byte into a stream, until it gets played on the
   soundcard. This is simply a shortcut to the sum of ARTS_P_BUFFER_TIME
   and ARTS_P_SERVER_LATENCY.
</li>
</ul><p>
</p><p></p><ul>
<li>ARTS_P_BLOCKING (rw)
   If this parameter is 1 (the default), arts_read/arts_write will block
   when not all data can be read/written successfully, and wait until it
   works. If this parameter is 0, arts_read/arts_write will return
   the number of successfully read/written bytes immediately.
 </li>
</ul><p>
</p><A NAME="arts_stream_set"></A><A NAME="ref12"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>int &nbsp;<underline>arts_stream_set</underline> (arts_stream_t stream, <A HREF="#arts_parameter_t">arts_parameter_t</A> param, int value)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 configure a parameter of a stream
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>stream</i></TD><TD align="left" valign="top">an opened record or play stream
</TD></TR>
<TR><TD align="left" valign="top"><i>parameter</i></TD><TD align="left" valign="top">the parameter you want to modify
</TD></TR>
<TR><TD align="left" valign="top"><i>value</i></TD><TD align="left" valign="top">the new value
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: the new value of the parameter (which may or may not be the value
          you wanted to have), or an error code if something went wrong
 </p>
<A NAME="arts_stream_get"></A><A NAME="ref13"></A><table width="100%"><tr bgcolor="#fafacb"><td><strong>int &nbsp;<underline>arts_stream_get</underline> (arts_stream_t stream, <A HREF="#arts_parameter_t">arts_parameter_t</A> param)
</strong></td></tr></table><p></p><p><small><code>#include &lt;artsc.h&gt;</code></small></p><p>
 query a parameter of a stream
</p><p></p><p></p><p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>stream</i></TD><TD align="left" valign="top">an opened record or play stream
</TD></TR>
<TR><TD align="left" valign="top"><i>parameter</i></TD><TD align="left" valign="top">the parameter you want to query
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: the value of the parameter, or an error code
 </p>
<hr>
<a href=index.html>back to index</a>
</BODY>
</HTML>
