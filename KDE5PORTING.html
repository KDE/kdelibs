<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide to Porting Applications to KDE Frameworks 5</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
body {
    font-size: 0.8em;
    font-family: "Bitstream Vera Sans", "Lucida Grande", "Trebuchet MS", sans-serif;
    color: #535353;
    background-color: #ffffff;
}

h1, h2, h3, h4, h5 {
    font-weight: bold;
    color: #f7800a;
}

a:link {
    padding-bottom: 0;
    text-decoration: none;
    color: #0057ae;
}

a:visited {
    padding-bottom: 0;
    text-decoration: none;
    color: #644A9B;
}

a[href]:hover {
    text-decoration: underline;
}

pre {
    display: block;
    margin: 0.3em;
    padding: 0.3em;
    font-size: 1em;
    font-family: Courier, 'Courier New', 'Andale Mono', Monaco, monospace;
    color: #000000;
    background: #f9f9f9;
    border: #2f6fab dashed;
    border-width: 1px;
    overflow: auto;
    line-height: 1.1em;
}
-->
</style>
</head>
<body>
<h1>Porting Applications to KDE Frameworks 5</h1>

<h2>Note</h2>

<p>This document contains the changes you have to apply to programs written for
KDE 4.x when you want to port them to KDE Frameworks 5.<br>

<h3><a name="TOC">Table of Contents</a></h3>

<UL>
<li><a href="#globalchanges">Global Changes</a></li>
<li><a href="#kdecore">Changes in kdecore</a></li>
<li><a href="#kdeui">Changes in kdeui</a></li>
<li><a href="#kio">Changes in kio</a></li>
<li><a href="#kparts">Changes in kparts</a></li>
</UL>

<h3><a name="globalchanges">Global Changes</a></h3>
<ul>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h3><a name="kdecore">Changes in kdecore</a></h3>

<ul>
<li>kdecore has been split up into a number of independent libraries: libkarchive, libkauth, libkdbus, etc.</li>
<li>KMimeType::comment and KMimeType::iconName no longer take a KUrl argument. If you were passing such an argument
(to support .directory files in directories), port the code to KFileItem::mimeComment and KFileItem::iconName.</li>
<li>KStandardDirs: KDE applications can keep using it, but independent frameworks should use QStandardPaths instead.
The porting depends on the resource type:
<pre>
    KStandardDirs "data" -&gt; QStandardPaths::GenericDataLocation
    KStandardDirs "appdata" -&gt; QStandardPaths::DataLocation
    KStandardDirs "config" -&gt; QStandardPaths::ConfigLocation
</pre>
If the resource is available in QStandardPaths (i.e. for all of the above), then the porting is simple:
<pre>
    KStandardDirs::locate("data", "kmyapp/my-data") -&gt; QStandardPaths::locate(QStandardPaths::GenericDataLocation, "kmyapp/my-data")
    saveLocation -&gt; writableLocation (note that you might have to mkpath it if it doesn't exist)
    locateLocal(type, file) -&gt; writableLocation(type) + '/' + file (you might have to mkpath the directory)
</pre>
Otherwise, you need to use GenericDataLocation and add the subdirectory name manually.
<pre>
    dirs()-&gt;resourceDirs("xdgdata-apps") -&gt; QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "applications", QStandardPaths::LocateDirectory)
    dirs()-&gt;findAllResources("xdgdata-mime", file) -&gt; QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "mime/" + file)
    dirs()-&gt;findAllResources("xdgdata-mime", "foo/*.txt") -&gt; QStandardPaths::standardLocations(QStandardPaths::GenericDataLocation) + foreach + entryList, prepending the absolute path.
</pre>
When the code uses wildcard filters or the Recursive flag in findAllResources, you cannot port it to one line of QStandardPaths.
Either keep using KStandardDirs, or write your own filtering (easy) or recursive listing (not as easy).

An easy case is KStandardDirs::findExe -&gt; QStandardPaths::findExecutable. Well, not so easy: it doesn't support looking into "libexec" at this point. To be resolved.
</li>
<li>KTemporaryFile is deprecated, port to QTemporaryFile instead, see KTemporaryFile API documentation for details.</li>
<li>KTempDir is deprecated, port to QTemporaryDir instead, see KTempDir API documentation for details.</li>
<li>KMimeType is deprecated, port to QMimeType instead. Here's a porting guide:
<pre>
   QMimeDatabase db; // All the methods need a db instance, but it's very cheap to create, on stack is fine.
   KMimeType::Ptr mime -&gt; QMimeType mime
   if (mime) -&gt; if (mime.isValid())
   KMimeType::mimeType(name) -&gt; db.mimeTypeForName(name)
   KMimeType::mimeType(name, DontResolveAlias) -&gt; db.mimeTypeForName(name) // there is no separate mime object for the alias
   KMimeType::findByUrl(url) -&gt; db.findByUrl(url)
   KMimeType::findByPath(path) -&gt; db.findByFile(path)
   KMimeType::findByPath(path, 0, true) -&gt; db.findByName(path) // TODO: delayed mimetype determination says conflicting globs should return default.
   KMimeType::findByContent(data) -&gt; db.findByData(data)
   KMimeType::findByNameAndContent(name, data_or_device) -&gt; db.findByNameAndData(name, data_or_device)
   KMimeType::findByFileContent(path) -&gt; QFile f(path); if (f.open(QIODevice::ReadOnly)) db.findByData(&amp;f)
   mime->name() == KMimeType::defaultMimeType() -&gt; mime.isDefault()
   KMimeType::extractKnownExtension(fileName) -&gt; db.suffixForFileName(fileName)
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h3><a name="kdeui">Changes in kdeui</a></h3>

<ul>
<li>KFloatValidator: Use KDoubleValidator instead (drop-in replacement)</li>
<li>KSvgRenderer: Use QSvgRenderer instead (drop-in replacement)</li>
<li>Proxy models: Moved to libitemmodels</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h3><a name="kio">Changes in kio</a></h3>

<ul>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h3><a name="kparts">Changes in kparts</a></h3>

<ul>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h3><a name="libkarchive">Changes in libkarchive</a></h3>

<ul>
    <li> KFilterBase::findFilterByFileName and KFilterBase::findFilterByMimeType are gone, now you should use KCompressionDevice::filterForCompressionType
    <li> To get the CompressionType you can call KFilterDev::compressionTypeForMimeType
    <li> KFilterDev::device is deprecated, instead you should use :
    <pre>
        KCompressionDevice::CompressionType type = KFilterDev::compressionTypeForMimeType(mimeType);
        KCompressionDevice flt(&amp;file, false, type);
    </pre>
    <li> KFilterDev::deviceForFile is deprecated, instead you should use :
    <pre>
        KFilterDev dev(fileName)
    </pre>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

</body>
</html>
