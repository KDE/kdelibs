<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide to Porting Applications to KDE Frameworks 5</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
body {
    font-size: 0.8em;
    font-family: "Bitstream Vera Sans", "Lucida Grande", "Trebuchet MS", sans-serif;
    color: #535353;
    background-color: #ffffff;
}

h1, h2, h3, h4, h5 {
    font-weight: bold;
    color: #f7800a;
}

a:link {
    padding-bottom: 0;
    text-decoration: none;
    color: #0057ae;
}

a:visited {
    padding-bottom: 0;
    text-decoration: none;
    color: #644A9B;
}

a[href]:hover {
    text-decoration: underline;
}

pre {
    display: block;
    margin: 0.3em;
    padding: 0.3em;
    font-size: 1em;
    font-family: Courier, 'Courier New', 'Andale Mono', Monaco, monospace;
    color: #000000;
    background: #f9f9f9;
    border: #2f6fab dashed;
    border-width: 1px;
    overflow: auto;
    line-height: 1.1em;
}
-->
</style>
</head>
<body>
<h1>Porting Applications to KDE Frameworks 5</h1>

<p>This document contains the changes you have to apply to programs written for
KDE 4.x when you want to port them to KDE Frameworks 5.<br>

<h2 id="TOC">Table of Contents</h2>

<ul>
<li><a href="#globalchanges">Global Changes</a></li>
<li><a href="#kdecore">Changes in kdecore</a></li>
<li><a href="#kdeui">Changes in kdeui</a></li>
<li><a href="#kio">Changes in kio</a></li>
<li><a href="#kfile">Changes in kfile</a></li>
<li><a href="#kparts">Changes in kparts</a></li>
<li><a href="#kemoticons">Changes in kemoticons</a></li>
</ul>

<h2 id="globalchanges">Global Changes</h2>
<ul>
    <li>The kde4_add_executable macro uses, should be changed into CMake's add_executable command.
    <ul>
        <li>The NOGUI tag in kde4_add_executable should be replaced by the ecm_mark_nongui_executable() macro in ECM</li>
        <li>The TEST tag in kde4_add_executable should be replaced by the ecm_mark_as_test() macro in ECM</li>
    </ul>
    </li>
    <li>The kde4_add_plugin uses, should be changed for add_library(... MODULE ...).<br/>
    If WITH_PREFIX was being used, you'll have to tell CMake what prefix you want: <code>set_target_properties(&lt;targetname&gt; PROPERTIES PREFIX "${CMAKE_SHARED_LIBRARY_PREFIX}")</code>

    </li>
    <li>KDE4_ADD_KDEINIT_EXECUTABLE should be turned into KF5_ADD_KDEINIT_EXECUTABLE, provided by KInitMacros.cmake.</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h2 id="kdecore">Changes in kdecore</h2>

<ul>
<li>kdecore has been split up into a number of independent libraries: libkarchive, libkauth, libkdbus, etc.</li>
<li>KUrl has been deprecated in favour of QUrl. Warning, look at the KUrl documentation for proper porting.
Do not just do a global search and replace, KUrl(QString) means "absolute local file or absolute url" while
QUrl(QString) means "relative url or absolute url" (so for local files you have to use QUrl::fromLocalFile(QString),
or if it could be local-or-remote, use QUrl::fromUserInput(QString)). Another porting trap is that
KUrl u; u.setPath("/tmp"); would make it file:///tmp, while QUrl u; u.setPath("/tmp"); is an incomplete URL, without
a scheme. The correct way with QUrl is QUrl::fromLocalFile("/tmp").
And finally KUrl::isParentOf means "parent or equal" while QUrl::isParentOf is strictly "parent" (see porting instructions in KUrl::isParentOf)
So I repeat: do NOT just globally replace KUrl with QUrl!</li>
<li>KUrl::upUrl is now the static method KIO::upUrl</li>
<li>For the reason above, many signals with a KUrl have been replaced with a QUrl:
<pre>
    KUrlRequester: urlSelected(const KUrl&amp;) &gt; urlSelected(const QUrl&amp;)
    KRecentFilesAction: urlSelected(const KUrl&amp;) &gt; urlSelected(const QUrl&amp;)
    KUrlComboBox: urlActivated(const KUrl&amp;) &gt; urlActivated(const QUrl&amp;)
    KPropertiesDialog: saveAs(KUrl,KUrl) &gt; saveAs(QUrl,QUrl)
</pre>
Remember to update your connect statements and your slots!
<li>KMimeType::comment and KMimeType::iconName no longer take a KUrl argument. If you were passing such an argument
(to support .directory files in directories), port the code to KFileItem::mimeComment and KFileItem::iconName.</li>
<li>KSaveFile has been deprecated in favour of the new QSaveFile:
<pre>
     open() -&gt; open(QIODevice::WriteOnly)
     finalize() -&gt; commit()
     abort() -&gt; cancelWriting()
     close() -&gt; do not call close, call commit or cancelWriting directly
     the return value from write() calls does not need to be checked anymore, commit will cancel in case of a write error.
</pre>
<li>KComponentData:
<ul>
    <li>The class is in kde4support now. Port away from it. In your main(), just remove the instanciation, use QCoreApplication::setApplicationName
    and QCoreApplication::setApplicationDisplayName instead. In plugins, see KPluginFactory/KPluginLoader.</li>
    <li>dirs() has been removed. You can use kde4support's KGlobal::dirs, but better port to QStandardPaths.
    The only difference (for other KComponentData instances than the main one),
    is the "appdata" resource, which would now point to the application name
    rather than the component name. It's cleaner to use "data" anyway (or QStandardPaths::GenericDataLocation),
    and prepend the component name to the searched file.</li>
</ul>
<li>KStandardDirs: KDE applications can keep using it, but independent frameworks should use QStandardPaths instead.
The porting depends on the resource type:
<pre>
    KStandardDirs "data" -&gt; QStandardPaths::GenericDataLocation
    KStandardDirs "appdata" -&gt; QStandardPaths::DataLocation
    KStandardDirs "config" -&gt; QStandardPaths::ConfigLocation
    KStandardDirs "xdgdata-apps" -&gt; QStandardPaths::ApplicationsLocation
    KStandardDirs "cache" -&gt; QStandardPaths::GenericCacheLocation
    KStandardDirs "socket" -&gt; QStandardPaths::RuntimeLocation
</pre>
If the resource is available in QStandardPaths (i.e. for all of the above), then the porting is simple:
<pre>
    KStandardDirs::locate("data", "kmyapp/my-data") -&gt; QStandardPaths::locate(QStandardPaths::GenericDataLocation, "kmyapp/my-data")
    KStandardDirs::locate("services", "foo.desktop") -&gt; QStandardPaths::locate(QStandardPaths::GenericDataLocation, "kde5/services/foo.desktop")
    dirs.findResource("data", relPath) -&gt; QStandardPaths::locate(QStandardPaths::GenericDataLocation, "kmyapp/my-data")
    dirs.findDirs("data", "kconf_update") -&gt; QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "kconf_update", QStandardPaths::LocateDirectory)
    saveLocation -&gt; writableLocation (note that you might have to mkpath it if it doesn't exist)
    locateLocal(type, file) -&gt; writableLocation(type) + '/' + file (you might have to mkpath the directory)
    locateLocal(tmp, file) -&gt; QDir::tempPath() + '/' + file
    resourceDirs("xdgdata-apps") -&gt; QStandardPaths::standardLocations(QStandardPaths::ApplicationsLocation)  (no trailing slashes anymore though)
</pre>
Otherwise, you need to use GenericDataLocation and add the subdirectory name manually.
<pre>
    dirs()-&gt;resourceDirs("xdgdata-icon") -&gt; QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "icons", QStandardPaths::LocateDirectory) // xdgata-icon is the "icons" subdir under the xdg data locations
    dirs()-&gt;findAllResources("xdgdata-mime", file) -&gt; QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "mime/" + file)
    Similarly, xdgconf-menu is QStandardPaths::ConfigLocation + "menus", and xdgconf-autostart is QStandardPaths::ConfigLocation + "autostart";
    "xdgdata-dirs" is QStandardPaths::GenericDataLocation + "desktop-directories"
    "templates" is QStandardPaths::GenericDataLocation + "templates"
    "emoticons" is QStandardPaths::GenericDataLocation + "emoticons
    "html" is QStandardPaths::GenericDataLocation + "doc/HTML"
    "sound" is QStandardPaths::GenericDataLocation + "sounds" (note the additional 's')
    "wallpaper" is QStandardPaths::GenericDataLocation + "wallpapers" (note the additional 's')
    "apps" was the kde3 "applnk" directory. Remove this compatibility code altogether, or port it to xdgdata-apps, i.e. QStandardPaths::ApplicationsLocation.
    (see kstandarddirs.cpp line 119 ff for resources that are missing here)
</pre>
When the code uses wildcard filters or the Recursive flag in findAllResources, you cannot port it to one line of QStandardPaths.
Either keep using KStandardDirs, or write your own filtering (QDir::entryList) or recursive listing (use QDirIterator with the Subdirectories flag).
Also, check for absolute paths first, findAllResources(res, "/absolute/path") returned the path, QStandardPaths doesn't.
<br/>
If NoDuplicates was used, make a unique list of relative paths first, then use locate on each one (see autostart.cpp for an example).
<br/>
Example using entryList:
<pre>
    QStringList files = dirs()-&gt;findAllResources("data", "foo/bar/*.desktop")
becomes:
    QStringList files;
    const QStringList dirs = QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "foo/bar", QStandardPaths::LocateDirectory);
    Q_FOREACH (const QString&amp; dir, dirs) {
        const QStringList fileNames = QDir(dir).entryList(QStringList() &lt;&lt; QStringLiteral("*.desktop"));
        Q_FOREACH (const QString&amp; file, fileNames) {
            files.append(dir + '/' + file);
        }
    }
</pre>
Example using QDirIterator:
<pre>
    QStringList files;
    const QStringList dirs = QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, "foo/bar", QStandardPaths::LocateDirectory);
    Q_FOREACH (const QString&amp; dir, dirs) {
        QDirIterator it(dir, QStringList() &lt;&lt; QStringLiteral("*.desktop"));
        while (it.hasNext()) {
            files.append(it.next());
        }
    }
</pre>
On the other hand, findAllResources("locale", "*/entry.desktop") requires
<pre>
    const QStringList localeDirs = QStandardPaths::locateAll(QStandardPaths::GenericDataLocation, QStringLiteral("locale"), QStandardPaths::LocateDirectory);
    Q_FOREACH (const QString &amp;localeDir, localeDirs) {
        const QStringList entries = QDir(localeDir).entryList(QDir::Dirs);
        Q_FOREACH (const QString &amp;d, entries) {
            if (QFile::exists(localeDir + '/' + d + "/entry.desktop")) {
                // ...
            }
        }
    }
</pre>
KStandardDirs::findExe (and the use of the "exe" resource) can be ported to QStandardPaths::findExecutable, except when the executable comes from libexec, in which case the path should just be hardcoded using CMAKE_INSTALL_PREFIX "/" LIBEXEC_INSTALL_DIR.

The "lib" resource was not used directly in code (the linker finds shared libs, not the code).

The "module" resource, on the other hand, was used to locate plugins. KPluginLoader now uses QT_PLUGIN_PATH instead, and looks in the kf5 subdirectory.
Please email kde-frameworks-devel@kde.org if you would need public API for this.

A script is available in kdesdk/kde-dev-scripts/kf5/convert-kstandarddirs.pl to port some of this.
</li>
<li>KConfig and KDesktopFile have been ported to QStandardPaths. This changes the "const char* resourceType" in the API into QStandardPaths::StandardLocation, and means that modifying the "config" resource before using KConfig has no effect on KConfig anymore.
</li>
<li>KConfigBase::sync now returns a bool</li>
<li>KCoreConfigSkeleton::writeConfig now returns a bool</li>
<li>KCoreConfigSkeleton::usrWriteConfig now returns a bool</li>
<li>KArchive::writeFile takes arguments in a different order from before, so that "user" and "group" are now optional, and so that const char* data, qint64 size could be replaced with a QByteArray.</li>
<li>KTemporaryFile is deprecated, port to QTemporaryFile instead, see KTemporaryFile API documentation for details.</li>
<li>KTempDir is deprecated, port to QTemporaryDir instead, see KTempDir API documentation for details.</li>
<li>KToolInvocation::invokeHelp is now KHelpClient::invokeHelp, in the kwidgets framework.</li>
<li>KToolInvocation::klauncher() has been removed. Use startKdeinit if you just want kdeinit/klauncher to be running. For setLaunchEnv(), generate klauncher_iface.h from the installed org.kde.KLauncher.xml.</li>
<li>KMD5 is deprecated, port to QCryptographicHash instead.</li>
<li>KMimeType is deprecated, port to QMimeType instead. Here's a porting guide:
<pre>
   QMimeDatabase db; // All the methods need a db instance, but it's very cheap to create, on stack is fine.
   KMimeType::Ptr mime -&gt; QMimeType mime
   if (mime) -&gt; if (mime.isValid())
   KMimeType::mimeType(name) -&gt; db.mimeTypeForName(name)
   KMimeType::mimeType(name, DontResolveAlias) -&gt; db.mimeTypeForName(name) // there is no separate mime object for the alias
   KMimeType::findByUrl(url) -&gt; db.mimeTypeForUrl(url)
   KMimeType::findByUrl(url, 0, is_local, true) -&gt; db.mimeTypeForFile(url.path(), QMimeDatabase::MatchExtension)
   KMimeType::findByPath(path) -&gt; db.mimeTypeForFile(path)
   KMimeType::findByPath(path, 0, true) -&gt; db.mimeTypeForFile(path, QMimeDatabase::MatchExtension)
       (this is slightly different in case of conflicting globs though, findByPath used to return empty,
        so that delayed mimetype determination could then refine this; mimeTypesForFileName can be useful
        to detect this case. But for most applications this detail doesn't matter).
   KMimeType::findByContent(data) -&gt; db.mimeTypeForData(data)
   KMimeType::findByNameAndContent(name, data_or_device) -&gt; db.mimeTypeForNameAndData(name, data_or_device)
   KMimeType::findByFileContent(path) -&gt; db.mimeTypeForFile(path, QMimeDatabase::MatchContent)
   mime-&gt;name() == KMimeType::defaultMimeType() -&gt; mime.isDefault()
   mime.allParentMimeTypes() -&gt; mime.allAncestors()
   KMimeType::extractKnownExtension(fileName) -&gt; db.suffixForFileName(fileName)
   KMimeType::iconNameForUrl(url) has additional logic on top of db.mimeTypeForUrl(url).iconName(), to
      fallback to the protocol-specific icon (e.g. trash icon for trash:/, etc.). This logic has now
     moved to KIO::iconNameForUrl.
   KMimeType::patterns() -&gt; QMimeType::globPatterns()
   KMimeType::allMimeTypes() -&gt; db.allMimeTypes()
</pre>
</li>
<li>KLocale has been split up: KLocale is now only about locale settings, while translation support has moved to KLocalizedString (ki18n framework). Translation catalogs are no longer dynamically inserted, so the idiom
<pre>
    KGlobal::locale()-&gt;insertCatalog("somecatalog")
</pre>
is no longer available. To simply make the code build, for the sake of porting other things first, just remove or comment out these calls. This will stop translations from working, and to fully port them eventually, follow the section "Connecting Calls to Catalogs" in ki18n programmer's guide.
</li>
<li>KCmdLineArgs uses K4AboutData rather than KAboutData: K4AboutData keeps the old mechanism for delayed translations
 (I18N_NOOP), while KAboutData is the one used by plugins, which can use immediate translation (i18n).
</li>
<li>KEncodingDetector is removed, port to KEncodingProber. Porting guide:
<pre>
    KEncodingDetector detector -&gt; KEncodingProber prober
    enum KEncodingDetector::AutoDetectScript -&gt; enum KEncodingProber::ProberType
    detector.encoding() -&gt; prober.encoding()
    detector.visuallyOrdered() -&gt; check prober.encoding() hebrew
    detector.autoDetectLanguage() -&gt; prober.proberType()
    detector.setAutoDetectLanguage(script) -&gt; prober.setProberType(proberType)
    detector.decode(data) -&gt; prober.feed(data) + QTextCodec::codecForName(prober.encoding())-&gt;toUnicode(data)
    detector.decodeWithBuffering(data, len) -&gt; prober.feed(data1), feed(data2), feed(data3) + check prober.state() + QTextCodec::codecForName(prober.encoding())-&gt;makeDecoder()
    detector.decodedInvalidCharacters() -&gt; QTextCodec::codecForName(prober.encoding())-&gt;makeDecoder() + hasFailure()
    detector.resetDecoder() -&gt; prober.reset()
    detector.flush() -&gt; prober.feed(data1), feed(data2), feed(data3) + QTextCodec::codecForName(prober.encoding())-&gt;toUnicode
    KEncodingDetector::scriptForName(lang) -&gt; KEncodingProber::proberTypeForName(lang)
    KEncodingDetector::nameForScript(script) -&gt; KEncodingProber::nameForProberType(proberType)
    KEncodingDetector::hasAutoDetectionForScript(script) -&gt; if (proberType == KEncodingProber::None) ... else ...
    KEncodingProber::encodingName() is removed, use KEncodingProber::encoding() instead.
</pre>
    The following functions have been moved into khtml with the orignal KEncodingDetector class. khtml is the only user of them.
<pre>
    enum KEncodingDetector::EncodingChoiceSource -&gt; removed
    KEncodingDetector::setEncoding(encoding, choice) -&gt; removed, implement it in khtml code
    KEncodingDetector::encodingChoiceSource() -&gt; removed
</pre>
</li>
<li>qtest_kde.h is deprecated. Port to &lt;QtTest&gt;, for core tests, or to &lt;QtTestWidgets&gt; for tests that use widgets, otherwise they'll crash in code that requires QApplication internally.</li>
<li>K_EXPORT_PLUGIN is deprecated. Either use Qt's <a href="http://qt-project.org/doc/qt-5.0/qtcore/plugins-howto.html#the-lower-level-api-extending-qt-applications">native plugin system</a> for simple plugins, or the K_PLUGIN_FACTORY or the K_PLUGIN_FACTORY_WITH_JSON macro, defined in kpluginfactory.h. In both cases, remove the K_EXPORT_PLUGIN macro from your code. This case is indicated by the K_EXPORT_PLUGIN_is_deprecated_see_KDE5PORTING warning. More details about the plugin factoiry changes are explained <a href="http://vizzzion.org/blog/2013/08/kde-frameworks-5-plugin-factory-guts/">in this article</a>. </li>
<li>KAuthorized::authorizeUrlAction and KAuthorized::allowUrlAction have been moved to a new KUrlAuthorized namespace.</li>
<li>KStringHandler::naturalCompare() is deprecated now, QCollator (QtCore) should be used from now on. If you still want the exact same old behavior, you can use it from kstringhandler_deprecated.h (KDE4Support),</li>
<li>KDebug is deprecated, use QDebug instead:
<pre>
    kDebug() -> qDebug()
    kError() -> qCritical()
    kFatal() -> qFatal()
    kWarning() -> qWarning()
</pre>
<ul>
<li>For categorized logging like kDebug(1221), see <a href="http://community.kde.org/Frameworks/Porting_To_qCDebug">this wiki page</a>.</li>
</ul>
</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h2 id="kdeui">Changes in kdeui</h2>

<ul>
<li>KApplication/KUniqueApplication: use QApplication instead, but make sure to:
   <ul>
   <li>Call QCoreApplication::setApplicationName("...")</li>
   <li>Call QCoreApplication::setApplicationVersion("...") (from the old KAboutData object)</li>
   <li>Call QCoreApplication::setOrganizationDomain("kde.org")</li>
   <li>Call QApplication::setApplicationDisplayName(i18n("...")) for GUI programs</li>
   <li>Use KDBusService for DBus registration, and optional "unique" behavior</li>
   <li>Important: if you create a QApplication (instead of KApplication) after using KCmdLineArgs,
       do not pass argc and argv to it, but KCmdLineArgs::qtArgc() and KCmdLineArgs::qtArgv().
       This can go away when porting away from KCmdLineArgs.</li>
   </ul>
</li>
<li>KLineEdit: Use QLineEdit instead, setClickMessage(...) becomes setPlaceholderText(...)</li>
<li>KIntValidator: Use QIntValidator instead, the only difference was that KIntValidator attempted to
  support non-decimal bases (but it was broken with prefix and suffix texts, and therefore unused in KDE SC)</li>
<li>KDoubleValidator: Use QDoubleValidator instead (as part of KLocale -&gt; QLocale)</li>
<li>KFloatValidator: Use QDoubleValidator instead (drop-in replacement)</li>
<li>KSvgRenderer: Use QSvgRenderer instead (drop-in replacement)</li>
<li>KCursor: Use QCursor instead</li>
<li>KIdentityProxyModel: Removed, used QIdentityProxyModel instead (trivial search/replace)</li>
<li>Other proxy models: Moved to libitemmodels</li>
<li>KPassivePopup: standardView() now returns a QWidget* instead of a KVBox*. The QWidget has a QVBoxLayout, i.e., additional widgets can be appended by calling widget-&gt;layout()-&gt;addWidget().</li>
<li>KCodecAction: use enum KEncodingProber::ProberType instead of enum KEncodingDetector::AutoDetectScript</li>
<li>KXMessages: the "obsolete = false" argument has been removed from all methods, and int screen has a default value of -1 now. Remove the "-1, false" in all calls. The sendMessage and sendMessageX methods were apparently unused, and have been commented out. Email kde-frameworks-devel at kde.org if you need them back.</li>
<li>KGlobalSettings::contextMenuKey is gone, reimplement QWidget::contextMenuEvent() instead.</li>
<li>KGlobalSettings::*Font methods are deprecated. Use QFontDatabase::systemFonts(). ::menuFont, ::taskBarFont and ::toolBarFont are not available now (they are provided by the QPA but not public API). If cases needing those arise we'll
have to find an alternative</li>
<li>KGlobalSettings::naturalCompare is deprecated, you'll have to especifically read the settings:
<pre>
    KConfigGroup g( KSharedConfig::openConfig(), "KDE" );
    m_naturalSorting = g.readEntry("NaturalSorting", true);
</pre>
</li>
<li>KMessageBox changes:
    <ul>
        <li>KMessageBox is no longer a class, but a namespace, as it only had static methods. The KMessageBox namespace spans now in two frameworks:
            <ul>
                <li>Queued methods are now in kmessagebox_queued.h from kde4support framework</li>
                <li>The remainder of the methods are now in kmessagebox.h from kwidgetsaddons</li>
            </ul>
        </li>
        <li>setDontShowAskAgainConfig was renamed to setDontShowAgainConfig</li>
        <li>KMessageBox methods now return enums instead of ints. While code using int will continue to build, you are encouraged to switch to enums for better type safety.</li>
    </ul>
</li>
<li>KMessageBoxMessageHandler moved to kde4support</li>
<li>KNotification: setComponentData(KComponentData) is now setComponentName(QString), only the component name was used.</li>
<li>KActionCollection and KXMLGUIClient: replace setComponentData with setComponentName and setComponentDisplayName</li>
<li>KAction changes
    <ul>
        <li>Shape and rocker gestures are now handled by KGestureMap. The existing KAction methods related to gesture handling delegate to KGestureMap.</li>
    </ul>
</li>
<li>KGestureMap changes:
    <ul>
        <li><b>addGesture</b> renamed to <b>setShapeGesture</b> and <b>setRockerGesture</b> and now allow replacing existing gestures. When this occurs, a warning is traced with qDebug.</li>
        <li>new <b>setDefault[Shape|Rocker]Gesture</b> methods allow defining default gestures for an action, providing the functionality removed from KAction.</li>
        <li>new <b>shapeGesture</b> and <b>defaultShapeGesture</b> methods retrieves already defined shape gestures for a given action</li>
        <li>new <b>rockerGesture</b> and <b>defaultRockerGesture</b> methods retrieves already defined rocker gestures for a given action</li>
    </ul>
</li>
<li>KAction global shortcut handling logic moved to KGlobalAccel. So the KAction::globalShortcutChanged signal was removed and a new corresponding KGlobalAccel::globalShortcutChanged has been added. The signal semantics have not changed.
</li>
<li>KUndoStack: Use QUndoStack with KUndoActions::createUndoAction() and KUndoActions::createRedoAction() instead</li>
<li>KRichTextWidget: createActions() does not take any KActionCollection and returns a list of QAction instead. You could use KActionCollection.addActions(KRichTextWidget.createActions()) instead.</li>
<li>KTextBrowser: Use QTextBrowser instead. The only difference is QTextBrowser does not support "whatsthis:" urls.</li>
<li>KTimeZoneWidget: Was copied as K4TimeZoneWidget in KDE4Support framework. A new KTimeZoneWidget replacement might appear so we freed the name.</li>
<li>KSystemEventFilter was removed as Qt 5 uses XCB instead of XLib. To get the same functionality derive from QAbstractNativeEventFilter, filter XCB events and register the filter in the QCoreApplication:
<pre>
class MyXcbEventFilter : public QAbstractNativeEventFilter
{
public:
    MyXcbEventFilter()
    {
        QCoreApplication::instance()-&gt;installNativeEventFilter(this);
    }
    virtual bool nativeEventFilter(const QByteArray &amp;eventType, void *message, long int*) Q_DECL_OVERRIDE
    {
        if (eventType != &quot;xcb_generic_event_t&quot;) {
            // only interested in XCB  events
            return false;
        }
        auto *event = static_cast&lt;xcb_generic_event_t*&gt;(message);
        switch (event-&gt;response_type &amp; 0x80) {
        case XCB_KEY_PRESS:
            auto *keyEvent = reinterpret_cast&lt;xcb_key_press_event_t*&gt;(event);
            // handle key press event...
            return true;
        case XCB_KEY_RELEASE:
            // ...
        }
        return false;
    }
};
</pre>
</li>
<li>KDialog: It has been deprecated and moved to kde4support. Prefer QDialog.
Note that there Ctrl+Enter is not set by default for accepting dialogs, we'd suggest to add them explicitly, especially in cases where QTextEdit is used, since then it's very hard to accept the dialog without using the mouse.

You can do so by using:
<pre>
QDialogButtonBox* box = ...;
...;
button->setShortcut(Qt::CTRL | Qt::Key_Return);
</pre>

In styles based on KStyle, this will work out of the box.

</li>
<li>KStyle: Was copied as K4Style in KDE4Support framework. New KStyle class has been trimmed down and reimplements only necessary methods to enforce some of the user settings (for example icons).
K4Style users should use K_EXPORT_K4STYLE instead of K_EXPORT_STYLE</li>
<li>KPixmapSequence now can only be instanced with a fullPath, to use XDG icons use KIconLoader::loadPixmapSequence.</li>
<li>ToolBar has moved to XMLGUI. If you don't want to depend on XMLGUI, use QToolBar instead, with the following setup:
   <ul>
   <li>Set ToolButtonStyle to Qt::ToolButtonFollowStyle, this will make QToolBar use the settings for "Main Toolbar"</li>
   <li>Additionally set QToolBar::setProperty("otherToolbar", true) to use settings for "Other toolbars"</li>
   <li>
    <pre>QToolBar *toolbar = new QToolBar();
toolbar->setToolButtonStyle(Qt::ToolButtonFollowStyle);
toolbar->setProperty("otherToolbar", true);</pre>
   </li>

   Settings from "Other toolbars" will only work on  a widget style that derives from KStyle
</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h2 id="kio">Changes in kio</h2>

<ul>
  <li>The very common job-&gt;ui()-&gt;setWindow(widget) has to be ported to KJobWidgets::setWindow(job, widget), because job-&gt;ui() is now only a KJobUiDelegate.</li>
  <li>The deprecated KIO::Job::showErrorDialog() has been removed, use KJobWidgets::setWindow(job, parent) and job-&gt;ui()-&gt;showErrorMessage()
  <li>The KFileItem API has been ported to QMimeType. As a consequence, mimeTypePtr() is now currentMimeType().</li>
  <li>KFileItem::run(QWidget*) has disappeared, due to core/gui separation. Use new KRun(item.targetUrl(), widget) instead.</li>
  <li>KFileItem::pixmap(size, state=0) has disappeared, due to core/gui separation. If you can, use KIcon(item.iconName(), 0, item.overlays()) instead.
   If you really need a QPixmap, e.g. for showing in a QLabel, use this instead:
  <pre>
    KIconLoader::global()-&gt;loadMimeTypeIcon(item.iconName(), KIconLoader::Desktop, size, state);
  </pre>

  <li>KIO::pixmapForUrl has moved from kio/global.h to kio/pixmaploader.h (so that global.h is core only)</li>
  <li>KProtocolInfo::isHelperProtocol() and exec() no longer detect apps associated with x-scheme-handler/*. This has moved up to KRun. Therefore KProtocolInfo is again about .protocol files only.</li>
  <li>KIO::RenameDialogPlugin was removed, it was unused for a long time anyway. The rename dialog uses KFileMetaDataWidget and PreviewJob instead.</li>
  <li>When Job::setUiDelegate(0) is used on a CopyJob (KIO::copy or KIO::move), an extra call to setUiDelegateExtension(0) is probably necessary, to disable skip and rename dialogs.</li>
  <li>KIO::Job::isInteractive() has been removed, use uiDelegate() or uiDelegateExtension() depending on what is meant (error messages, or rename/skip dialog).</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h2 id="kfile">Changes in kfile</h2>

<ul>
  <li>libkfile is now called KIOFileWidgets, part of the KIO framework.</li>
  <li>KFileWidget no longer inherits KAbstractFileWidget (which no longer exists). KAbstractFileWidget::{OperationMode, Other, Opening, Saving} is now KFileWidget::{...}</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h2 id="kparts">Changes in kparts</h2>

<ul>
  <li>With the port from KUrl to QUrl in APIs, the signature of the virtual method openUrl has changed, make sure
      to port your reimplemented methods to QUrl!</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h2 id="itemviews">Changes in itemviews</h2>
<ul>
<li>KCategoryDrawer margins should be set by overriding the leftMargin/rightMargin methods as appropriate.
</ul>

<h2 id="itemviews">Changes in itemviews</h2>
<ul>
<li>KWidgetItemDelegate::createItemWidgets now has an QModelIndex with the index to create widgets for. It does not need to be used</li>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

<h2 id="libkarchive">Changes in libkarchive</h2>

<ul>
    <li> KFilterBase::findFilterByFileName and KFilterBase::findFilterByMimeType are gone, now you should use KCompressionDevice::filterForCompressionType
    <li> To get the CompressionType you can call KFilterDev::compressionTypeForMimeType
    <li> KFilterDev::device is deprecated, instead you should use :
    <pre>
        KCompressionDevice::CompressionType type = KFilterDev::compressionTypeForMimeType(mimeType);
        KCompressionDevice flt(&amp;file, false, type);
    </pre>
    <li> KFilterDev::deviceForFile is deprecated, instead you should use :
    <pre>
        KFilterDev dev(fileName)
    </pre>
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>


<h2 id="kemoticons">Changes in kemoticons</h2>

<ul>
    <li> KEmoticonsProvider::save is deprecated, instead you should use KEmoticonsProvider::saveTheme
    <li> KEmoticonsTheme::save is deprecated, instead you should subclass KEmoticonsProvider and implement the pure virtual method KEmoticonsProvider::saveTheme
    <li> KEmoticonsProvider::createNew is deprecated, instead you should use KEmoticonsProvider::newTheme
    <li> KEmoticonsTheme::createNew is deprecated, instead you should subclass KEmoticonsProvider and implement the pure virtual method KEmoticonsProvider::newTheme
    <li> KEmoticonsProvider::addEmoticonsMap is deprecated, instead you should use KEmoticonsProvider::addMapItem
    <li> KEmoticonsProvider::removeEmoticonsMap is deprecated, instead you should use KEmoticonsProvider::removeMapItem
    <li> KEmoticonsProvider::addEmoticonIndex is deprecated, instead you should use KEmoticonsProvider::addIndexItem
    <li> KEmoticonsProvider::removeEmoticonIndex is deprecated, instead you should use KEmoticonsProvider::removeIndexItem
    <li> KEmoticonsTheme::loadTheme is deprecated, instead you should subclass KEmoticonsProvider and implement the pure virtual method KEmoticonsProvider::loadTheme
    <li> KEmoticonsTheme::addEmoticon is deprecated, instead you should subclass KEmoticonsProvider and implement the pure virtual method KEmoticonsProvider::addEmoticon
    <li> KEmoticonsTheme::removeEmoticon is deprecated, instead you should subclass KEmoticonsProvider and implement the pure virtual method KEmoticonsProvider::removeEmoticon
</ul>

<h4 align="right"><a href="#TOC">Return to the Table of Contents</a></h4>

</body>
</html>
